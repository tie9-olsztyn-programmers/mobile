"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([[3440],{4330:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>s,contentTitle:()=>r,default:()=>j,frontMatter:()=>d,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"Nawigacja i  fragmenty/Fragmenty/PrzekazywanieDanychViewModel","title":"ViewModel - przekazywanie danych","description":"Kontynuujemy projekt z poprzedniej lekcji.","source":"@site/docs/10.Nawigacja i  fragmenty/10.Fragmenty/15.PrzekazywanieDanychViewModel.mdx","sourceDirName":"10.Nawigacja i  fragmenty/10.Fragmenty","slug":"/Nawigacja i  fragmenty/Fragmenty/PrzekazywanieDanychViewModel","permalink":"/mobile/docs/Nawigacja i  fragmenty/Fragmenty/PrzekazywanieDanychViewModel","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/10.Nawigacja i  fragmenty/10.Fragmenty/15.PrzekazywanieDanychViewModel.mdx","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"title":"ViewModel - przekazywanie danych"},"sidebar":"tutorialSidebar","previous":{"title":"cz. 2 Przekazywanie argument\xf3w w Navigation Component","permalink":"/mobile/docs/Nawigacja i  fragmenty/Fragmenty/czesc2PrzekazywanieDanych"},"next":{"title":"BottomNavigationView","permalink":"/mobile/docs/Nawigacja i  fragmenty/Fragmenty/BottomNavigationView"}}');var o=n(4848),l=n(8453);const d={title:"ViewModel - przekazywanie danych"},r="M\xf3j w\u0142asny potw\xf3r - ViewModelu",s={},c=[{value:"Zmiana wymaga\u0144",id:"zmiana-wymaga\u0144",level:2},{value:"<code>ViewModel</code>",id:"viewmodel",level:2},{value:"Konfiguracja projektu",id:"konfiguracja-projektu",level:3},{value:"Teoria",id:"teoria",level:3},{value:"Praktyka",id:"praktyka",level:3}];function t(e){const i={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.header,{children:(0,o.jsxs)(i.h1,{id:"m\xf3j-w\u0142asny-potw\xf3r---viewmodelu",children:["M\xf3j w\u0142asny potw\xf3r - ",(0,o.jsx)(i.code,{children:"ViewModelu"})]})}),"\n",(0,o.jsx)(i.p,{children:"Kontynuujemy projekt z poprzedniej lekcji."}),"\n",(0,o.jsx)(i.h2,{id:"zmiana-wymaga\u0144",children:"Zmiana wymaga\u0144"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"SecondFragment"})," wysy\u0142a dane do ",(0,o.jsx)(i.code,{children:"FirstFragment"})]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"FirstFragment"})," od razu reaguje i wy\u015bwietla je"]}),"\n",(0,o.jsxs)(i.li,{children:["wszystko w ramach jednej aktywno\u015bci, bez ",(0,o.jsx)(i.code,{children:"popBackStack()"})," i bez u\u017cycia ",(0,o.jsx)(i.code,{children:"savedStateHandle"})]}),"\n"]}),"\n",(0,o.jsx)(i.h2,{id:"viewmodel",children:(0,o.jsx)(i.code,{children:"ViewModel"})}),"\n",(0,o.jsx)(i.h3,{id:"konfiguracja-projektu",children:"Konfiguracja projektu"}),"\n",(0,o.jsxs)(i.p,{children:[(0,o.jsx)(i.code,{children:"lib.versions.toml"})," dodajemy potrzebne biblioteki"]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-toml",children:'[versions]\n...\n\nandroidx-fragment = "1.7.1"\nandroidx-lifecycle = "2.8.0"\n\n\n[libraries]\n...\nandroidx-fragment-ktx = { module = "androidx.fragment:fragment-ktx", version.ref = "androidx-fragment" }\nandroidx-lifecycle-viewmodel-ktx = { module = "androidx.lifecycle:lifecycle-viewmodel-ktx", version.ref = "androidx-lifecycle" }\nandroidx-lifecycle-livedata-ktx = { module = "androidx.lifecycle:lifecycle-livedata-ktx", version.ref = "androidx-lifecycle" }\n\n...\n\n'})}),"\n",(0,o.jsxs)(i.p,{children:[(0,o.jsx)(i.code,{children:"build.gradle.kts"})," (module)"]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-kts",children:"...\ndependencies {\n\n    //viewmodel\n    implementation(libs.androidx.fragment.ktx)\n    implementation(libs.androidx.lifecycle.viewmodel.ktx)\n    implementation(libs.androidx.lifecycle.livedata.ktx)\n\n...\n\n\n"})}),"\n",(0,o.jsx)(i.p,{children:"Pami\u0119taj o synchronizacji projektu!!!!"}),"\n",(0,o.jsx)(i.h3,{id:"teoria",children:"Teoria"}),"\n",(0,o.jsxs)(i.p,{children:["Osi\u0105gniemy to przez ",(0,o.jsxs)(i.strong,{children:["u\u017cycie wsp\xf3lnego ",(0,o.jsx)(i.code,{children:"ViewModelu"})," pomi\u0119dzy fragmentami."]})]}),"\n",(0,o.jsxs)(i.admonition,{type:"note",children:[(0,o.jsxs)(i.mdxAdmonitionTitle,{children:["Co to jest ",(0,o.jsx)(i.code,{children:"ViewModel"}),"?"]}),(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:[(0,o.jsx)(i.code,{children:"ViewModel"})," to specjalna klasa, kt\xf3ra:"]}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"przechowuje dane i logik\u0119 ekranu (fragmentu lub aktywno\u015bci),"}),"\n",(0,o.jsxs)(i.li,{children:["przetrwa rotacj\u0119 ekranu (czyli nie ginie przy ",(0,o.jsx)(i.code,{children:"onDestroyView()"}),"),"]}),"\n",(0,o.jsx)(i.li,{children:"i umo\u017cliwia wymian\u0119 danych mi\u0119dzy fragmentami w tej samej aktywno\u015bci."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"Cykl \u017cycia"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"Zwyk\u0142y Fragment ma bardzo kr\xf3tki cykl \u017cycia:"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"jego widok jest niszczony np. przy rotacji ekranu,"}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["przez to tracisz wszystkie dane z ",(0,o.jsx)(i.code,{children:"EditText"}),", ",(0,o.jsx)(i.code,{children:"CheckBox"}),", itp."]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["A ",(0,o.jsx)(i.code,{children:"ViewModel"}),":"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"przetrwa rotacj\u0119,"}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"zachowa stan,"}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"i zostanie zniszczony, dopiero gdy Activity zostanie zamkni\u0119ta."}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"Jak dzia\u0142a w tle"}),"\n",(0,o.jsxs)(i.ol,{children:["\n",(0,o.jsxs)(i.li,{children:["Android ma specjalny magazyn ",(0,o.jsx)(i.code,{children:"ViewModeli"})," przypisany do ka\u017cdej ",(0,o.jsx)(i.code,{children:"Activity"}),"."]}),"\n",(0,o.jsxs)(i.li,{children:["Gdy pierwszy raz poprosisz o ",(0,o.jsx)(i.code,{children:"ViewModel"}),", Android tworzy go i zapisuje w tym magazynie."]}),"\n",(0,o.jsxs)(i.li,{children:["Przy rotacji ekranu Android niszczy widoki, ale nie magazyn, wi\u0119c Tw\xf3j ",(0,o.jsx)(i.code,{children:"ViewModel"})," zostaje."]}),"\n",(0,o.jsxs)(i.li,{children:["Nowy Fragment po rotacji dostaje ten sam obiekt ",(0,o.jsx)(i.code,{children:"ViewModel"}),", a nie nowy."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"Powi\u0105zane elementy:"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"ViewModel"})," przechowuje dane i logik\u0119 UI"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"LiveData"})," pozwala fragmentowi obserwowa\u0107 zmiany danych w ViewModelu"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"activityViewModels()"})," umo\u017cliwia fragmentom w tej samej aktywno\u015bci wsp\xf3\u0142dzieli\u0107 jeden ViewModel"]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,o.jsxs)(i.admonition,{type:"tip",children:[(0,o.jsxs)(i.mdxAdmonitionTitle,{children:[(0,o.jsx)(i.code,{children:"LiveData"})," metaforycznie"]}),(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"jest jak radio"}),"\n",(0,o.jsx)(i.li,{children:"Gdy tylko kto\u015b co\u015b zmieni (np. opis potwora), to"}),"\n",(0,o.jsx)(i.li,{children:"radio natychmiast powiadamia wszystkich, kt\xf3rzy nas\u0142uchuj\u0105"}),"\n",(0,o.jsx)(i.li,{children:"nie musisz pyta\u0107 co chwil\u0119 \u201eczy co\u015b si\u0119 zmieni\u0142o?\u201d \u2013 radio samo Ci to powie."}),"\n"]})]}),"\n",(0,o.jsxs)(i.admonition,{type:"tip",children:[(0,o.jsxs)(i.mdxAdmonitionTitle,{children:[(0,o.jsx)(i.code,{children:"ViewModel"})," metaforycznie"]}),(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:["je\u017celi ",(0,o.jsx)(i.code,{children:"Acitvity"})," to mieszkanie, fragmenty to pokoje"]}),"\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"ViewModel"})," jest jak","\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"szafka na przedpokoju"}),"\n",(0,o.jsx)(i.li,{children:"ka\u017cdy fragment (pok\xf3j) ma do niej dost\u0119p"}),"\n",(0,o.jsx)(i.li,{children:"w jej szufladach s\u0105 r\xf3\u017cne dane, kt\xf3re fragmenty mog\u0105:"}),"\n",(0,o.jsx)(i.li,{children:"odczytywa\u0107"}),"\n",(0,o.jsx)(i.li,{children:"zmienia\u0107"}),"\n",(0,o.jsxs)(i.li,{children:["a ",(0,o.jsx)(i.code,{children:"LiveData"})," powiadamia wszystkie fragmenty o zmianach w szufladach"]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,o.jsx)(i.h3,{id:"praktyka",children:"Praktyka"}),"\n",(0,o.jsxs)(i.p,{children:["Napiszmy w\u0142asny ",(0,o.jsx)(i.code,{children:"ViewModel"})," dla potwora."]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.code,{children:"MostrViewModel.kt"})}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-kotlin",children:"import androidx.lifecycle.LiveData\nimport androidx.lifecycle.MutableLiveData\nimport androidx.lifecycle.ViewModel\n\nclass MonsterViewModel: ViewModel() {\n    private val _monsterDescription = MutableLiveData<String>()\n    val monsterDescription: LiveData<String> get() = _monsterDescription\n\n    fun sendMosterDescrtiption(description: String) {\n        _monsterDescription.value = description\n    }\n\n}\n"})}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"Chcemy, \u017ceby oba fragmenty mia\u0142y ten sam ViewModel (nie osobne kopie)."}),"\n",(0,o.jsxs)(i.li,{children:["Dlatego pobierzemy go z poziomu ",(0,o.jsx)(i.code,{children:"Activity"})," (czyli wsp\xf3lnego w\u0142a\u015bciciela)."]}),"\n"]}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-kotlin",children:"// w\u0142a\u015bciwo\u015b\u0107 obiektu MainAcitivity\n...\n  private val sharedViewModel: MonsterViewModel by viewModels()\n...\n"})})]})}function j(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,o.jsx)(i,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>d,x:()=>r});var a=n(6540);const o={},l=a.createContext(o);function d(e){const i=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),a.createElement(l.Provider,{value:i},e.children)}}}]);